DB 설계 변경

### UserRecord 테이블 폐기

처음에는 user 생성 및 프로파일 조회에 필요한 데이터와, user의 활동에의해 생성된데이터들을 보관하는 테이블을 구분해주고자 UserRecord를 만들었다.

이는 순전히 개발의 편의성을 위함이었다.

특정 사용자제공 기능을 구현하기 위함은 아니었지만
UserRecord의 정보들을 한번에 읽어서 유저의 활동로그도 제공할 수있을거같기도 했다.

하지만 빡준님과 영서님의 열띤 가르침을 통해서, 이렇게 테이블을 분리하면,
유저의 활동을 집계하여 표시하는 데이터를 만들때 굉장히 비용이 높은 연산들을 사용하게됨을 깨달았다.

그래서 userRecord를 폐기하고, 유저활동과 관련된 모든테이블을
유저와 직접 릴레이션을 갖게 해주었다.

그리고 또 유저의 활동을 기록하는 테이블 `ActivityLog`를 아예 그냥 새로 만들었다.
유저가 특정 활동을 할때마다, 기록 테이블 레코드를 생성하는 방식이다.

```
const newMeetUp = await prisma.meetUp.create({/* meetUp data */});
await prisma.activityLog.create({
    data: {
        userId: newMeetup.userId,
        activityType:'Meetup'
        activityId: newMeetUp.id
    }
})
```

- 새 게시글 작성시 Post 개체와 + ActivityLog개체를 추가로 생성한다.

여기에 더하여 `Notification` 테이블도 만들었다.
만약 유저의 활동이 타인의 활동과 연관이되어있다면 새로운 개체를 생성한다.

즉 내가 어떤 유저의 게시물에 댓글을 달았다면
댓글개체/활동로그개체/알람개체 이렇게 세개가 생성되는것이다.

너무 쿼리의 양이 늘어나는것같기도 하지만, pscale이 제공하는 db 접근 조건을 생각해보면 차고 넘칠것 같아 이렇게 정했다.

### 토큰에 관한 조언

Twilio와 sendGrid를 이용해 메일을 보내 유저가 비밀번호 찾기를 하는 기능을 계획했다.
로직은 다음과 같다.

```
1. 유저가 phone/email 전송
2. 서버가 해당 phone/email이 존재하는지 확인
    - 존재한다면 토큰을 생성, payload에 랜덤난수를 입력하고, 문자나 이메일로 payload전송
    - 브라우저는 토큰 입력 폼으로 전환
3. 유저가 입력받은 토큰을 폼에 입력
4. 서버는 입력받은 값과 토큰 테이블에있는 토큰의 payload를 비교
5. 일치할시 새로운 비밀번호 입력폼 / 혹은 랜덤생성 비밀번호 제공
```

하지만 이계획에서 토큰테이블은 폐기했다.
빡준님은 이것을 서버에서 토큰을 보관하여 처리하지말고, 쿠키에 담아 클라이언트에게 책임을 떠넘기는게 좋다고 하셨다.

이유는 다음과 같다.

1. 토큰 테이블을 따로 보관하지 않아 DB성능개선을 가능케함.
2. 서버가 다른서버로 변경되어도, 클라이언트가 하던 작업을 계속 할 수있게함.

개인적으로 2번은 현재의 토큰으로도 가능한 작업인것같다.
그리고 또, 이 사이드 프로젝트를 하는동안 서버가 다른 서버로 변경될일도 없다.
하지만 도전해볼만한 가치가 있는 일인것같아 따르기로했다.

그런데.. 이것자체가 모든것을 Session에 위임하고 있으므로,
JWT 및 stateLess는 다음 프로젝트 및 팀프로젝트에서 도전해볼것이다.

https://www.erdcloud.com/d/DX5JZsnmtffDtr535

### 게시물 생성기능

대체로 댓글이나 리뷰, 그리고 밋업과 관련된 로직은 전부 다음과 같은 순서로 진행된다.

a. 프론트 부분

1. useMutation => upload 쿼리를 보낸다
2. useForm => 보낼 쿼리에 알맞은 타입의 데이터를 가공해준다.

   - validation도 추가해야함

3. useRouter => 게시물 업로드 완료시 해당 게시물 주소로 이동한다 / 댓글은 머무른다.

b. 백엔드 부분

1. req.session 내부의 user를 확인한다.
2. req.body의 payload와 1번에서 확인한 user를 결합하여
   데이터를 생성한다.
3. 활동레코드/알람레코드를 생성한다.

c. 프론트 부분

생성된 데이터가 표시될 detail 화면에서 getStaticProps등을 이용해 뿌려준다.

d. 프론트 부분

생성된 데이터와같은종류의 데이터들을 늘어놓은 메뉴 화면에서도 마찬가지로 getStaticProps, getStaticPaths등을 이용해 뿌려준다.

파악한 문제: UI적인 문제: 채팅으로 이동시 화면 및 bottomBar가 흔들린다.
