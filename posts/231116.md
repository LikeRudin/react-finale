https://www.prisma.io/blog/how-to-improve-startup-times-kdRB9MjPEv

'Best Practices To Speed Up Your Serverless Applications'

프리스마 블로그에서 'Serverless 앱의 속도를 향상시키는 방법들' 을 읽었습니다.

serverless로 개발을한다면, handler를 실핼할때 'cold start'라는 문제가 있다고 합니다.

이것은 serverless 환경에서는 실행할 함수의 인스턴스가 존재하지 않을 경우,
먼저 이를 생성해야 함수의 실행이 지연된다는 것을 의미합니다.

이것에의한 앱 성능 저하를 방지하기 위해선 handler를 가능한 가볍게 만들어야 한다고 합니다.
handler에는 쿼리 로직만 남기고, 나머지는 전부 외부로 분리하는것이 상책이라고 합니다.

예를 들어, handler 데이터베이스에서 받은 데이터를 사용자가 보기 좋은 형태로 가공하는 로직이 있다면,
핸들러 외부에서 처리해야 합니다. 데이터베이스에서 받은 시간 데이터를 'YYYY-MM-DD' 형식으로 변경하는 로직 같은 경우가 있겠지요.

또한 response header 를 수정하여 redirection을 실행시키는 등의 로직들을 사용하지말고,
핸들러의 반환값을 확인하는 부분에서 처리하라고 합니다.

하지만 데이터 가공 로직을 프론트엔드로 넘기는 것이 조금 꺼려지기도 합니다. 이에 대해 노마드 디스코드 커뮤니티에 공유했을 때, 서버리스 프로그래밍을 개발하면서 콜드 스타트를 고려한다면 데이터 가공의 책임을 프론트엔드에 넘기는 것이 최선이라는 의견을 받았습니다.

그리고 OAS를 사용하여 데이터베이스, 백엔드, 프론트엔드의 API를 연동하는 방법에 대한 노션 회고도 공유해주셨습니다.

이제 제 코드를 수정해야하는데,
serverless이기때문에, 컴포넌트 부분에서 데이터를 가공하지 않고,
커스텀 훅, getServerSideProps, 미들웨어등으로 해당 로직을 분리해야겠습니다.

근데 vercel은 middleware 호출에 요금을 부과하므로..
커스텀 훅이 최선인거같습니다.
